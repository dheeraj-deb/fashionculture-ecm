{{>user/header-v4}}

<div id="refresh-section">
    {{#if products}}
    <!-- breadcrumb -->


    <section class="shopping-cart spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <div class="shopping__cart__table">
                        <table>
                            <thead>
                                <tr class="d-flex justify-content-between">
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each products}}
                                <tr style="display: flex;
	                                   align-items: center;">
                                    <td class="product__cart__item">
                                        <div class="product__cart__item__pic">
                                            <img src="/images/{{this.products.img_id.[0]}}" alt="" style="width: 100px;
                                            height: 100px;
                                            object-fit: cover;">
                                        </div>
                                        <div class="product__cart__item__text">
                                            <h6>{{this.products.product_name}}</h6>
                                            <h5>Rs.{{this.products.discount_price}}</h5>
                                        </div>
                                    </td>
                                    <td class="quantity__item d-flex d-md-block justify-content-center">

                                        {{!-- quantity --}}
                                        <input type="hidden" class="prodId" value="{{this.product._id}}">
                                        <div class="wrap-num-product flex-w  m-0">
                                            <div onclick="changeQty('{{this._id}}', '{{this.products._id}}','-1', event)"
                                                {{#when this.qty 'eq' '1' }} style="pointer-events: none;" {{/when}}
                                                class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m">
                                                <i class="fs-16 zmdi zmdi-minus"></i>
                                            </div>

                                            <input class="mtext-104 cl3 txt-center num-product" type="number"
                                                name="num-product1" value="{{this.qty}}">

                                            <div onclick="changeQty('{{this._id}}', '{{this.products._id}}', '1', event)"
                                                class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m">
                                                <i class="fs-16 zmdi zmdi-plus"></i>
                                            </div>
                                        </div>


                                    </td>
                                    <td class="cart__price ">Rs.{{this.sum}}</td>
                                    <td class="cart__close"
                                        onclick="removecCartProduct('{{this._id}}', '{{this.products._id}}')"><i
                                            class="fa fa-close"></i></td>
                                </tr>

                                {{/each}}

                            </tbody>
                        </table>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="continue__btn">
                                <a href="#">Continue Shopping</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal -->
                <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLongTitle">Copy Your Coupon</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                {{#if coupon}}
                                <div class="row">
                                    <div class="col-6">
                                        <img src="/Coupon 8x3 in.jpeg" alt="">
                                    </div>
                                    <div class="col-6">
                                        <h4 class="text-dark">Fashion Culture</h4>
                                        <h6 id="textToCopy">{{coupon.code}}</h6>
                                        <p id="copyResult"></p>
                                        <h6>Save {{coupon.value}}%</h6>
                                        <h6>Valid till {{coupon.end_date}}</h6>
                                    </div>
                                </div>
                                {{else}}
                                <div class="d-flex align-items-center jstify-content-center">
                                    <h6>OOps! You Have No Coupons!</h6>
                                </div>
                                {{/if}}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="copyButton">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="cart__discount ">
                        <h6 class="mb-1">Discount codes</h6>
                        <form class="mb-3">
                            <input type="text" id="coupon_input" name="coupon_code" placeholder="Coupon code">
                            <button type="button" onclick="create_coupon_discount(event)">Apply</button>
                        </form>
                        <button onclick="showCoupon(event)" class="btn btn-dark" data-toggle="modal"
                            data-target="#exampleModalCenter"
                            style="border-radius: 0px; background-color: #111111; border-color: #111111;">Show
                            Coupons</button>
                    </div>
                    <div class="cart__total">
                        <h6>Cart total</h6>
                        <div class="d-flex justify-content-between">
                            <h6 id="coupon-applied" class="me-1"></h6>
                            <a href="" id="remove" onclick="removeCoupon(event)" class="text-danger"></a>
                        </div>
                        <ul>
                            <li>Subtotal <span>Rs.{{total}}</span></li>
                            <li>Discount <span>Rs.<span id="discount"></span></span></li>
                            <li>Total <span id="total">Rs.{{total}}</span></li>
                        </ul>
                        <a href="/placeorder" class="primary-btn">Proceed to checkout</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {{else}}

    <div class="container d-flex flex-column align-items-center justify-content-center h-75">
        <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
        <lottie-player src="https://assets2.lottiefiles.com/packages/lf20_qh5z2fdq.json" background="transparent"
            speed="1" style="width: 300px; height: 300px;" loop autoplay></lottie-player>
        <a class="text-primary" href="/">Shop Now !</a>
    </div>

    {{/if}}

</div>


<script>


    function showCoupon() {
        const answer = document.getElementById("copyResult");
        const copy = document.getElementById("copyButton");
        const selection = window.getSelection();
        const range = document.createRange();
        const textToCopy = document.getElementById("textToCopy")

        copy.addEventListener('click', function (e) {
            range.selectNodeContents(textToCopy);
            selection.removeAllRanges();
            selection.addRange(range);
            const successful = document.execCommand('copy');
            if (successful) {
                textToCopy.style = "display:none"
                answer.innerHTML = 'Coupon Copied!';
            } else {
                answer.innerHTML = 'Unable to copy!';
            }
            window.getSelection().removeAllRanges()
        });
    }






</script>